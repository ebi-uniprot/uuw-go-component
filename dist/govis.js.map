{"version":3,"file":"govis.js","sources":["../src/main.js"],"sourcesContent":["import './govis.scss';\n\nclass GoVis extends HTMLElement {\n    constructor() {\n        super();\n        this.annotationTerms = [];\n        this.goRootNodes = ['GO:0008150', 'GO:0003674', 'GO:0005575'];\n        this.accession = '';\n    }\n\n    attributeChangedCallback() {\n        this.innerHTML = ''; //this should be avoided\n        this.loadData();\n        console.log(`Loaded ${this.accession}`);\n    }\n\n    static get observedAttributes() {\n        return ['accession'];\n    }\n\n    set accession(acc) {\n        if (acc) {\n            this.setAttribute('accession', acc);\n        }\n    }\n\n    get accession() {\n        return this.getAttribute('accession');\n    }\n\n    loadData() {\n        this.getAnnotationTerms(this.accession).then(stream => {\n            stream.json().then(d => {\n                this.annotationTerms = d.dbReferences.filter(d => d.type === 'GO');\n                let goIds = this.annotationTerms.filter(d => d.type === 'GO').map(d => d.id);\n                this.getSlimSet().then(stream => {\n                    stream.json().then(d => {\n                        const slimIds = d.goSlimSets.filter(f => f.name === 'goslim_generic')[0].associations.map(term => term.id);\n                        // remove root nodes\n                        for (const rootNode of this.goRootNodes) {\n                            slimIds.splice(slimIds.indexOf(rootNode), 1);\n                        }\n                        this.getTermGraph(goIds, slimIds).then(d => d.json().then(graph => {\n                            const tree = this.buildTree(graph.results[0].vertices, graph.results[0].edges);\n                            const ul = document.createElement('ul');\n                            this.traverseTree(tree, ul);\n                            this.appendChild(ul);\n                        }));\n                    });\n                })\n            });\n        });\n    }\n\n    getAnnotationTerms(accession) {\n        const headers = new Headers({\n            'Accept': 'application/json'\n        });\n        const init = {\n            method: 'GET',\n            headers: headers,\n            mode: 'cors',\n            cached: 'default'\n        }\n        return fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${accession}`, init);\n    }\n\n    getSlimSet() {\n        return fetch('https://www.ebi.ac.uk/QuickGO/services/internal/presets?fields=goSlimSets');\n    }\n\n    getTermGraph(goIds, slimIds) {\n        return fetch(`https://wwwdev.ebi.ac.uk/QuickGO/services/ontology/go/terms/graph?startIds=${goIds}&stopIds=${slimIds}&relations=is_a`);\n    }\n\n    buildTree(nodes, edges) {\n        // Initialise node array\n        nodes.map(n => n.children = []);\n        let rootNodes = nodes.map(n => n.id);\n        for (const edge of edges) {\n            let parent = nodes.filter(node => node.id === edge.object)[0];\n            let child = nodes.filter(node => node.id === edge.subject)[0];\n            if (rootNodes.indexOf(child.id) >= 0) {\n                rootNodes.splice(rootNodes.indexOf(child.id), 1);\n            }\n            parent.children.push(child);\n        }\n        // Return root nodes\n        return nodes.filter(node => {\n            for (const rootNode of rootNodes) {\n                if (node.id === rootNode) {\n                    return true;\n                }\n            }\n            return false;\n        })\n    }\n\n    traverseTree(children, el) {\n        for (const node of children) {\n            const div = document.createElement('div');\n            const li = document.createElement('li');\n            const a = document.createElement('a');\n            a.setAttribute('href', `http://www.ebi.ac.uk/QuickGO-Beta/term/${node.id}`);\n            a.textContent = node.id;\n            const span = document.createElement('span');\n            let annotationNode = this.annotationTerms.find(d => d.id === node.id);\n            span.style.fontWeight = annotationNode ? 'bold' : 'normal';\n            span.textContent = node.label;\n            div.appendChild(a);\n            div.appendChild(span);\n            li.appendChild(div);\n            if (annotationNode) {\n                div.appendChild(this.getRenderSource(annotationNode.properties));\n            }\n            el.appendChild(li);\n            if (node.children && node.children.length > 0) {\n                div.addEventListener('click', this.nodeClick);\n                li.classList.add('branch');\n                const ul = document.createElement('ul');\n                ul.style.marginLeft = '1em';\n                li.appendChild(ul);\n                this.traverseTree(node.children, ul);\n            }\n        }\n    }\n\n    nodeClick() {\n        this.parentElement.classList.toggle('open');\n    }\n\n    getRenderSource(source) {\n        const span = document.createElement('span');\n        span.classList.add('evidence-tag');\n        span.textContent = source.source;\n        return span;\n    }\n\n    expandAll() {\n        for (const li of this.querySelectorAll('.branch')) {\n            li.classList.add('open');\n        }\n    }\n\n    collapseAll() {\n        for (const li of this.querySelectorAll('.open')) {\n            li.classList.remove('open');\n        }\n    }\n}\n\ncustomElements.define('go-vis', GoVis);\n\nexport default GoVis;"],"names":["GoVis","annotationTerms","goRootNodes","accession","innerHTML","loadData","log","getAnnotationTerms","then","json","d","dbReferences","filter","type","goIds","map","id","getSlimSet","slimIds","goSlimSets","f","name","associations","term","rootNode","splice","indexOf","getTermGraph","tree","buildTree","graph","results","vertices","edges","ul","document","createElement","traverseTree","appendChild","headers","Headers","init","fetch","nodes","n","children","rootNodes","edge","parent","node","object","child","subject","push","el","div","li","a","setAttribute","textContent","span","annotationNode","find","style","fontWeight","label","getRenderSource","properties","length","addEventListener","nodeClick","classList","add","marginLeft","parentElement","toggle","source","querySelectorAll","remove","acc","getAttribute","customElements","define"],"mappings":"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"}